const apiMainUrl="https://api.winnipegtransit.com/v3",apiKey="api-key=G0ZNynR9C1I5fFkrMET",searchForm=document.querySelector("form"),inputArea=document.querySelector("input"),streetListSec=document.querySelector(".streets"),scheduleTable=document.querySelector("tbody"),titleBarStreetName=document.querySelector("#street-name"),busInfoPerRoute=1;function retrieveStreetList(e){fetch(`${apiMainUrl}/streets.json?${apiKey}&name=${e}&usage=long`).then(e=>{if(e.ok)return e.json();throw new Error("Fail to retrieve data.")}).then(e=>updateStreetList(e.streets))}function retrieveStopList(e){fetch(`${apiMainUrl}/stops.json?${apiKey}&street=${e}`).then(e=>{if(e.ok)return e.json();throw new Error("Fail to retrieve data.")}).then(e=>{const t=[];e.stops.forEach(e=>{t.push(fetch(`${apiMainUrl}/stops/${e.key}/schedule.json?${apiKey}&max-results-per-route=${busInfoPerRoute}`).then(e=>{if(e.ok)return e.json();throw new Error("Fail to retrieve data.")}).then(e=>e["stop-schedule"]))}),Promise.all(t).then(t=>{updateStopSchedule(t),updateTitle(e)})})}function updateTitle(e){let t;void 0!==e.stops[0]?(t=e.stops[0].street.name,titleBarStreetName.innerText=`Displaying results for "${t}".`):titleBarStreetName.innerText="No stops were found."}function updateStreetList(e){let t="";0===e.length?t="No results were found.":e.forEach(e=>{t+=`<a href="#" data-street-key="${e.key}">${e.name}</a>`}),streetListSec.innerHTML=t}function updateStopSchedule(e){let t="";e.forEach(e=>{e["route-schedules"].forEach(r=>{r["scheduled-stops"].forEach(n=>{void 0!==n.times.arrival&&(t+=`\n            <tr>\n              <td>${e.stop.street.name}</td>\n              <td>${e.stop["cross-street"].name}</td>\n              <td>${e.stop.direction}</td>\n              <td>${r.route.key}</td>\n              <td>${formatTime(n.times.arrival.estimated)}</td>\n            </tr>\n          `)})})}),scheduleTable.innerHTML=t}function formatTime(e){return new Date(e).toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"})}searchForm.addEventListener("submit",e=>{""!==inputArea.value.trim()&&(retrieveStreetList(inputArea.value),scheduleTable.innerHTML="",titleBarStreetName.innerText=""),inputArea.value="",e.preventDefault()}),streetListSec.addEventListener("click",e=>{"A"===e.target.tagName&&(scheduleTable.innerHTML="",retrieveStopList(e.target.dataset.streetKey))});